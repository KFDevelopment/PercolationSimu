<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Percole</title>
</head>
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous">
</script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<style>
table {
  min-width: 600px;
  min-height: 600px;
    border-collapse: collapse;
}

table, th, td {
    border: 1px solid black;
    box-sizing: border-box;
}

.block{
  background-color: #687387;
}

.full{
  background-color: #0147c6;
}
</style>
<body style="overflow: hidden">

  <div class="row">
    <div class="col-sm-3">
      <div class="card" style="width: 18rem;">
      <div class="card-body">
        <h5 class="card-title">Grid parameters</h5>
        <div>
        <form>
          <div class="form-group">
            <label for="gridSize">Grid size :</label>
            <input type="number" class="form-control" id="gridSize" aria-describedby="emailHelp" placeholder="0-100" value=20 max="100" min="10">
          </div>
          <div class="form-group">
            <label for="randonPercentage">Completion % :</label>
            <input type="number" class="form-control" id="randonPercentage" aria-describedby="emailHelp" placeholder="0-1" value=0.5 max="1" min="0" step="0.1">
            <br>
            <button type="button" class="btn btn-outline-primary" id="random">Random generation</button>

              <br />
            <button type="button" class="btn btn-primary" id="start" style="margin-top:10px">Launch process !</button>

          </div>
            <h5 class="card-title">Result</h5>
            <div style="min-height:50px;">
            <div class="alert alert-success" role="alert" id=percole>
              Percole !
            </div>
            <div class="alert alert-danger" role="alert" id=notPercole>
              Don't percole !
            </div>
          </div>

        </form>
      </div>
      </div>
    </div>
    </div>
    <div class="col-sm-9">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Grid</h5>
          <table>

          </table>
        </div>
      </div>
    </div>
  </div>




</body>
<script>

var gridSize = $("#gridSize").val();
var clickToDrag = false;
var grid = [];
var gridTwoDim = [];
var currentPositionX = 0;
var currentPositionY = 0;

var maxPositionY = 0;

  $(function(){
    redrawGrid(gridSize);

  });

  $("body").on("drag", function(e) {
    e.preventDefault();
  })



  function redrawGrid(gridSize){
    maxPositionY = 0;
    $("#percole,#notPercole").hide();
    grid = [];
    gridTwoDim = [];
    var gridLine = "";
    var globalIndex = 0;
    for(var i = 0; i< gridSize; i++){
      gridTwoDim[i] = [];
      gridLine += "<tr>";
      for (var j = 0; j < gridSize; j++) {
        gridLine += "<td id="+globalIndex+" onmouseup=\"unClick()\"  onmousedown=\"clickCell("+globalIndex+")\" onmouseover=\"enterCell("+globalIndex+")\"></td>";

        //status : 0 => empty, 1=> block, 2 => full
        grid.push({id:globalIndex, x:j, y:i, status:0});
        gridTwoDim[i].push(0);
        globalIndex += 1;

      }
      gridLine += "</tr>";
    }
    $("table").html(gridLine);
  }

  $("#gridSize").on("input", function(){
    gridSize = $("#gridSize").val();
    redrawGrid(gridSize);
  });

function clickCell(id){
    if($("#" + id).hasClass("block")){
      $("#" + id).removeClass("block");
    }
    else{
      $("#" + id).addClass("block");
      var index = grid.findIndex(x => x.id == id);
      grid[id].status = 1;
      gridTwoDim[grid[id].y][grid[id].x] = 1;
      clickToDrag = true;
    }
}
function enterCell(id){
  if(clickToDrag){
    var index = grid.findIndex(x => x.id == id);
    grid[id].status = 1;
    gridTwoDim[grid[id].y][grid[id].x] = 1;
    $("#" + id).addClass("block");
  }
}

function unClick(){
  clickToDrag = false;
}

$("#start").on("click", function(){
  findStartCursorPosition();
  console.log("start");
  percole(currentPositionX, currentPositionY);
})

function findStartCursorPosition(){
  var firstValidElem = grid.find(x => x.status == 0);

  $("#" + firstValidElem.id).css("background-color" , "green");

  currentPositionX = firstValidElem.x;
  currentPositionY = firstValidElem.y;

  percole(currentPositionX, currentPositionY);

  var cell = grid.find(x => x.x == currentPositionX && x.y == currentPositionY);
  $("#" + cell.id).css({"background-color" : "red"});

  if(maxPositionY == (gridSize - 1)){
    $("#percole").show();
  }
  else{
    $("#notPercole").show();
  }
}

function percole(positionX, positionY){

  if(positionY > maxPositionY){
    maxPositionY = positionY;
  }

  currentPositionX = positionX;
  currentPositionY = positionY;

  var cell = grid.find(x => x.x == positionX && x.y == positionY);
  console.log(positionX);
  if(gridTwoDim[positionY][positionX] == 0){
      gridTwoDim[positionY][positionX] = 2;
      cell.status = 2;
      $("#" + cell.id).addClass("full");
  }



  if((positionX + 1) != gridSize){
    if(gridTwoDim[positionY][positionX + 1] == 0 || positionY == 0){
      percole(positionX + 1, positionY);
    }
  }
  if((positionY + 1) != gridSize){
    if(gridTwoDim[positionY + 1][positionX] == 0){
      percole(positionX, positionY + 1);
    }
  }
  if((positionY -1) >= 0){
    if(gridTwoDim[positionY - 1][positionX] == 0){
      percole(positionX, positionY - 1);
    }
  }
  if((positionX - 1) >= 0){
    if(gridTwoDim[positionY][positionX - 1] == 0){
      percole(positionX - 1, positionY);
    }
  }
}

$("#random").on("click", function(){
  redrawGrid(gridSize);
  var nbCell = gridSize * gridSize;
  var randomValue = Math.round($("#randonPercentage").val() * nbCell);
  var i = 0;
  while(i < randomValue){
    var randomNb = Math.floor((Math.random() * nbCell));
    var cell = grid.find(x => x.id == randomNb);
    if(cell.status == 0){
      clickCell(cell.id);
      i += 1;
    }
  }
clickToDrag = false;
})


</script>
</html>
